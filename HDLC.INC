;---段定义---
?pr?HDLC?Mater	SEGMENT CODE
?co?HDLC?FLASHSTR	SEGMENT CODE
EXTRN	BIT(BIT_CHANNELFLAG)
;EXTRN	BIT(BIT_HDLCRXS)
;EXTRN	BIT(BIT_HDLC_BST_FIRST)
EXTRN	BIT(BIT_BUFADDR)
EXTRN	BIT(BIT_BST)
EXTRN	BIT(BIT_TMP)

EXTRN	DATA(DATA_RXBUF)
EXTRN	DATA(DATA_PowerONTimer)
EXTRN	DATA(DATA_DSRCTXLEN,DATA_DSRCRXLEN)
EXTRN	XDATA(XDATA_TOTALNUML)
EXTRN	XDATA(XDATA_HOLD)

EXTRN	CODE(_FUN_LIB_DELAY)
;EXTRN	CODE(_getrsuadcrc)
EXTRN	CODE(_FUN_LIB_BEEP)
EXTRN	CODE(_getnewcrc_xr)
EXTRN	CODE(_getnewcrc)
EXTRN	CODE(ap_start)

EXTRN	CODE(_FUN_LIB_DELAY50)
EXTRN	CODE(_FUN_LIB_DELAY49)
EXTRN	CODE(_FUN_LIB_DELAY48)
EXTRN	CODE(_FUN_LIB_DELAY47)
EXTRN	CODE(_FUN_LIB_DELAY46)
EXTRN	CODE(_FUN_LIB_DELAY45)
EXTRN	CODE(_FUN_LIB_DELAY44)
EXTRN	CODE(_FUN_LIB_DELAY43)
EXTRN	CODE(_FUN_LIB_DELAY42)
EXTRN	CODE(_FUN_LIB_DELAY41)
EXTRN	CODE(_FUN_LIB_DELAY40)
EXTRN	CODE(_FUN_LIB_DELAY39)
EXTRN	CODE(_FUN_LIB_DELAY38)
EXTRN	CODE(_FUN_LIB_DELAY37)
EXTRN	CODE(_FUN_LIB_DELAY36)
EXTRN	CODE(_FUN_LIB_DELAY35)
EXTRN	CODE(_FUN_LIB_DELAY34)
EXTRN	CODE(_FUN_LIB_DELAY33)
EXTRN	CODE(_FUN_LIB_DELAY32)
EXTRN	CODE(_FUN_LIB_DELAY31)
EXTRN	CODE(_FUN_LIB_DELAY30)
EXTRN	CODE(_FUN_LIB_DELAY29)
EXTRN	CODE(_FUN_LIB_DELAY28)
EXTRN	CODE(_FUN_LIB_DELAY27)
EXTRN	CODE(_FUN_LIB_DELAY26)
EXTRN	CODE(_FUN_LIB_DELAY25)
EXTRN	CODE(_FUN_LIB_DELAY24)
EXTRN	CODE(_FUN_LIB_DELAY23)
EXTRN	CODE(_FUN_LIB_DELAY22)
EXTRN	CODE(_FUN_LIB_DELAY21)
EXTRN	CODE(_FUN_LIB_DELAY20)
EXTRN	CODE(_FUN_LIB_DELAY19)
EXTRN	CODE(_FUN_LIB_DELAY18)
EXTRN	CODE(_FUN_LIB_DELAY17)
EXTRN	CODE(_FUN_LIB_DELAY16)
EXTRN	CODE(_FUN_LIB_DELAY15)
EXTRN	CODE(_FUN_LIB_DELAY14)
EXTRN	CODE(_FUN_LIB_DELAY13)
EXTRN	CODE(_FUN_LIB_DELAY12)
EXTRN	CODE(_FUN_LIB_DELAY11)
EXTRN	CODE(_FUN_LIB_DELAY10)
EXTRN	CODE(_FUN_LIB_FLASHTOXDATA)
;EXTRN	CODE(_FUN_LIB_POWERDOWN)

;--- 输出定义 ---
PUBLIC	_FUN_HOLD_DIOPOINT
PUBLIC	_FUN_HDLC_RX			;HDLC接收函数
;PUBLIC	_FUN_HDLC_RXForBST		;HDLC接收函数(接收第一个BST专用)
PUBLIC	_FUN_HDLC_TX			;HDLC发送函数
PUBLIC	_FUN_HDLC_CHANGECHANNEL		;更改通道
PUBLIC	_FUN_HDLC_5830Init
;PUBLIC	_FUN_HDLC_5822Init
PUBLIC	_AutoASKReg
PUBLIC	_FUN_HDLC_5822Init
PUBLIC	_FUN_HDLC_Frexiaodui
;;--- FOR TEST --- 
EXTRN	CODE(_FUN_TEST_DISPLAY)
EXTRN	CODE(_FUN_TEST_BEEP)
EXTRN	CODE(_FUN_LIB_FLASHTOXDATALen)
;PUBLIC	_rxfromrsu
EXTRN	XDATA(XDATA_NUM)
EXTRN	XDATA(XDATA_TXBUF)

PUBLIC	SPI_RW
PUBLIC	SPI_Read_Reg
;public	SPI_Read_FIFO
;--- 输出函数 ---
;-----BK5822--------------------------------
;PUBLIC	_AutoASKReg
public	SPI_Write_Reg
PUBLIC	_Enter_TX_Carrier_Mode
PUBLIC	_Enter_Sleep_Mode
;PUBLIC	_TXDIOpin
PUBLIC  _Enter_Receive_Mode
PUBLIC	_Power_Up
PUBLIC	Tx_Carrier_En
PUBLIC	_FUN_HDLC_RXSetMMI

PUBLIC	_FUN_HDLC_CLOSECLR
;PUBLIC	_AutoASKReg_read
;PUBLIC	_AutoASKReg_uppower

PUBLIC	Rx_En
PUBLIC	_FUN_HDLC_ISSleepMod
PUBLIC	_FUN_HDLC_CheckReg9To18
PUBLIC	HDLC_5823_RXLOOP
PUBLIC	_FUN_HDLC_SWRX
;PUBLIC	_Enable_Wake_Up
;PUBLIC	_BK5822_RST		;复位BK5822 寄存器
;PUBLIC	_BK5822_RXTX		;R7=0 进入接收模式	R7=1 进入发送模式
PUBLIC	Rx_Carrier_En
	
PUBLIC	_Write_18_L,_Write_18_H	
	
	RSEG	?co?HDLC?FLASHSTR
RegArrOBU:
	
DB	042H,056H,056H,059H ;00
;DB	020H,0e6H,03aH,0ECH ;01[no] 0x20 00 3B EC  5.79G
DB      050H,0e4H,03aH,0ecH ;5.79G
;DB	020H,000H,03bH,0ECH ;01[no] 0x20 00 3B EC  5.80G
DB	020H,000H,0F0H,009H ;02 0x20 00 F0 09
DB	060H,03BH,000H,031H ;03 0x60 3B 00 31
;DB	03FH,0CFH,01CH,03FH ;4 FIFO发射
;DB	03DH,0CFH,00CH,03FH ;4;测试载波
;DB	03FH,0CFH,00CH,03FH ;4 调置fm0，但不是cw mode
;DB	03FH,0CFH,00CH,038H ;4 调置fm0，但不是cw mode
	;3c 0F 0C 38
	;3F CF 1C 38
	;3F CF 1C 38
DB	03FH,00FH,00CH,038H ;4 调置fm0，但不是cw mode 0x3C 0F 0C 38	380C0F3C
;DB	03CH,00FH,00CH,038H
	;w 0x3E CF 0C 04;
DB	030H,0D7H,0F2H,002H ;05 0x30 D7 F2 02
;DB	030H,06CH,0BDH,001H  ; 6个脉冲   	12.5~18k
;---DB      030H,030H,0BDH,001H  ; 唤醒6个脉冲  	11.5K--16K
DB      030H,030H,03DH,002H  ; 唤醒8个脉冲  	11.5K--16K
;DB      030H,030H,03DH,003H ; 唤醒12个脉冲  	11.5K--16K
;DB      030H,01cH,03DH,003H ; 唤醒12个脉冲  	13K--15K(唤醒灵敏度最低)
;DB      010H,01cH,03DH,003H ;唤醒12个脉冲  13K--15K(唤醒灵敏度最高)
DB	000H,000H,000H,09EH ;H 07 0x0000009E  唤醒高增益

;DB	000H,000H,000H,092H ;L		   	 唤醒低增益
DB	000H,000H,000H,000H ;08 0x00000000
;9~
RegArrOBU_09:
DB	01FH,050H,004H,098H ;09 0x1F 50 04 18[no]
;DB	01FH,050H,004H,018H ;09 0x1F 50 04 18[no]
DB	0FFH,001H,000H,000H ;10 0xFF 01 00 00
DB	004H,014H,030H,041H ;11 0x04 14 30 41
DB	010H,080H,001H,040H ;12 0x10 80 01 40
DB	020H,000H,002H,080H ;13 0x20 00 02 80
RegArrOBU14:
DB	0CDH,04CH,055H,055H ;14 0xCD 4C 55 55
;DB	0DDH,093H,074H,000H ;15	0xF1 13 70 00[no]
;DB	0F1H,013H,070H,000H ;15	0xF1 13 70 00[no]
;DB	0DDH,093H,074H,000H ;15	0xF1 13 70 00[no]

RegArrOBU15:
;DB	0DFH,013H,074H,000H ;15	0xF1 13 70 00[no]
;DB	0DDH,093H,074H,000H ;15	0xF1 13 70 00[no]
db      0FDH,093H,022H,00fH ;REG15[18]=0  REG15[5]=1 CRC 初值FFFF


db	
;	RegArrRSU_15[0] = 0xD3;
;	RegArrRSU_15[1] = 0x27;
;	RegArrRSU_15[2] = 0x74;
;	RegArrRSU_15[3] = 0xFF;  
;<15>
;Pin22 DIO output enable “0h”: DIO output BK5823 Datasheet ETC OBU SOC. 2012 Beken Corporation Proprietary and Confidential Page 27 of 31 data “1h”: DIO input data
;DB	0F1H,013H,070H,000H
;<3.2>  “11”: transmit data inputted from DIO
;---------------------------------------------------------
RegArrASKAnalogReg17:
	DB      000H,004H,004H,088H,084H,062H,0C1H,068H,038H,07EH,0BEH,0E7H,0DFH,0FFH   ;(最佳)
;DB	000H,000H,040H,080H,000H,00AH,091H,04AH,0A8H,094H,06AH,0B5H,05AH,0ADH  ;(差5dbm)
;DB 	000H,000H,000H,020H,040H,000H,085H,048H,025H,054H,04AH,0A5H,052H,0A9H	;(差6dbM)
;DB	000H,000H,000H,000H,010H,020H,080H,042H,0A4H,012H,02AH,095H,04AH,0A5H   ;(差8dbm)
;DB      000H,000H,000H,000H,000H,008H,010H,040H,021H,052H,009H,085H,042H,0A1H   ; (差10dbm)
;DB     000H,000H,000H,000H,000H,000H,004H,008H,0A0H,010H,0A9H,054H,02AH,095H ;(差13dbM)
;DB       000H,000H,000H,000H,000H,000H,000H,000H,001H,002H,028H,014H,00AH,085H	;差20dbm  接收/唤醒差11个DBM{10/14m}

RegArrASKAnalogReg18:
	db	  041H,010H,004H,0C1H,0FFH,0FFH,0FFH,01FH,004H,001H,00CH
	
	;db	0c3h,030h,00ch,0c3h,0ffh,0ffh,0ffh,03fh,00ch,003h,00ch;[张1]	
	
RegArrASKAnalogReg18_H:
	db	041H,010H,004H,0C1H,0FFH,0FFH,0FFH,01FH,004H,001H,00CH;[org]
RegArrASKAnalogReg18_L:
	;db	041H,010H,004H,0C1H,0FFH,0FFH,0FFH,01FH,004H,001H,00CH;[org]
	db	0c3h,030h,00ch,0c3h,0ffh,0ffh,0ffh,03fh,00ch,003h,00ch;[张1]	
	

	
	
	
